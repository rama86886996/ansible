- name: Install Java
  package: 
    name: java
    state: installed
  
- name: Add Application user
  user:
    name: "{{APPUSER}}"
    comment: "application user"

- name: Download & Extract Tomcat
  unarchive:
    src: "{{TOMCAT_URL}}"
    dest: "{{APPUSERHOME}}"
    remote_src: yes
  become_user: "{{APPUSER}}"

- name: Find old dir's
  find: 
    paths: "{{TOMCATDIR}}/webapps}}"
    file_type: any
  register: out

- name: Remove old webapps
  file:
    path: "{{item.path}}"
    state: absent
  loop: "{{out.files}}"

- name: Download WAR file
  get_url:
    url: "{{WAR_URL}}"
    dest: "{{TOMCATDIR}}/webapps/student.war"
  become_user: "{{APPUSER}}"